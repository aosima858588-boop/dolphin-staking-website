<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>H-Boost æŸç›Šæ¨¡æ‹Ÿå™¨ Â· é˜¶æ¢¯ç§¯åˆ†ç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        body {
            background: #f0f6fc;
            margin: 0;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 1400px;
            width: 100%;
            background: white;
            border-radius: 36px;
            box-shadow: 0 30px 45px -15px rgba(18,52,77,0.15);
            padding: 2rem 2rem 2.5rem;
        }
        h1 {
            font-size: 2.1rem;
            font-weight: 700;
            margin: 0 0 0.2rem;
            letter-spacing: -0.01em;
            background: linear-gradient(145deg, #0a384b, #1d5770);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .sub {
            color: #3a6075;
            font-size: 0.95rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid #d2e3ed;
            padding-bottom: 1.2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        .badge {
            background: #1f5770;
            color: white;
            padding: 0.3rem 1rem;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-right: 0.5rem;
        }
        .mode-selector {
            display: flex;
            gap: 1.2rem;
            background: #edf5fa;
            padding: 0.4rem;
            border-radius: 60px;
        }
        .mode-btn {
            padding: 0.5rem 1.6rem;
            border-radius: 40px;
            border: none;
            background: transparent;
            font-weight: 600;
            color: #1a4b5e;
            cursor: pointer;
            transition: 0.1s;
            font-size: 0.9rem;
        }
        .mode-btn.active {
            background: white;
            box-shadow: 0 4px 10px rgba(0,60,100,0.08);
            color: #0a3140;
        }
        .calculator-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.8rem;
        }
        @media (max-width: 1000px) {
            .calculator-panel {
                grid-template-columns: 1fr;
            }
        }
        .input-section, .output-section {
            background: #f7fcff;
            border-radius: 28px;
            padding: 1.8rem;
            border: 1px solid #cbe0ec;
        }
        .output-section {
            background: linear-gradient(145deg, #f2faff, #ffffff);
        }
        .param-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        .param-label {
            flex: 0 0 150px;
            font-weight: 600;
            color: #13506b;
            font-size: 0.95rem;
        }
        .param-input {
            flex: 1 1 200px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        input[type=number] {
            width: 150px;
            padding: 0.65rem 1rem;
            border: 1px solid #b4cfdf;
            border-radius: 20px;
            font-size: 1rem;
            background: white;
            transition: 0.15s;
        }
        input[type=number]:focus {
            border-color: #1f7f9c;
            outline: none;
            box-shadow: 0 0 0 3px rgba(31,127,156,0.1);
        }
        .unit {
            color: #3e6b80;
            font-size: 0.9rem;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            flex-wrap: wrap;
        }
        input[type=range] {
            width: 170px;
            height: 6px;
            background: #c8ddec;
            border-radius: 10px;
            -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #1b7a99;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0,60,100,0.2);
            cursor: pointer;
            border: 2px solid white;
        }
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.2rem;
            margin: 1.2rem 0;
        }
        .stat-card {
            background: white;
            border-radius: 18px;
            padding: 1rem 1.2rem;
            border: 1px solid #e1eef7;
        }
        .stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #4f7589;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        .stat-number {
            font-size: 1.9rem;
            font-weight: 700;
            color: #0b3b4c;
            line-height: 1.1;
        }
        .stat-unit {
            font-size: 0.9rem;
            color: #3f738a;
            margin-left: 0.2rem;
        }
        .highlight-green {
            background: #daf1e4;
            color: #0a5e44;
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
            font-weight: 600;
        }
        .highlight-red {
            background: #ffe1d6;
            color: #aa3025;
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
            font-weight: 600;
        }
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #b0d0df, transparent);
            margin: 1.8rem 0 1.2rem;
        }
        .footnote {
            font-size: 0.8rem;
            color: #4e7085;
            margin-top: 1.2rem;
            padding-top: 1.2rem;
            border-top: 1px solid #cde0eb;
        }
        .protocol-check {
            background: #e3f0f5;
            padding: 1.2rem 1.5rem;
            border-radius: 20px;
            margin-top: 1.2rem;
        }
        .ladder-table {
            background: #f3f9fd;
            border-radius: 18px;
            padding: 1.2rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .ladder-table table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem;
        }
        .ladder-table th {
            text-align: left;
            color: #1a5a6e;
            font-weight: 600;
            font-size: 0.75rem;
            padding: 0.4rem 0.2rem;
        }
        .ladder-table td {
            padding: 0.3rem 0.2rem;
            border-bottom: 1px solid #cde0eb;
        }
        .opt-tag {
            background: #ffd966;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            color: #3a3a00;
        }
        button {
            background: #1d6f8b;
            border: none;
            color: white;
            padding: 0.7rem 1.6rem;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.1s;
        }
        button:hover {
            background: #0e556d;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>âš¡ H-Boost é˜¶æ¢¯ç§¯åˆ†æ¨¡æ‹Ÿå™¨</h1>
    <div class="sub">
        <span class="badge">Uè´¨æŠ¼0.5%/æ—¥</span>
        <span class="badge">5%äº¤æ˜“ç¨</span>
        <span class="badge">è¿”ä½£0.34%</span>
        <span class="badge">å†…ç½®Rainbowé˜¶æ¢¯</span>
        <div class="mode-selector" id="modeSelector">
            <button id="modeLinear" class="mode-btn active">ğŸ“ˆ çº¿æ€§ç©ºæŠ•</button>
            <button id="modeLadder" class="mode-btn">ğŸ¯ é˜¶æ¢¯ç§¯åˆ†</button>
        </div>
    </div>

    <div class="calculator-panel">
        <!-- ========= å·¦ä¾§è¾“å…¥åŒº ========= -->
        <div class="input-section">
            <h3 style="margin-top:0; margin-bottom:1.8rem; font-weight:600; color: #135664;">ğŸ”§ ä½ çš„ç­–ç•¥å‚æ•°</h3>
            <!-- é€šç”¨å‚æ•° -->
            <div class="param-row">
                <span class="param-label">ğŸ”µ è´¨æŠ¼Ué‡‘é¢</span>
                <div class="param-input">
                    <input type="number" id="stakeU" value="10000" step="1000" min="100">
                    <span class="unit">U</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸ’ Hå¸‚åœºä»·</span>
                <div class="param-input">
                    <input type="number" id="hPrice" value="0.001" step="0.0001" min="0.0001" max="0.01">
                    <span class="unit">U</span>
                </div>
            </div>
            <div class="param-row">
                <span class="param-label">ğŸ§¾ veHé”ä»“åŠ æˆ</span>
                <div class="param-input slider-container">
                    <input type="range" id="boostMulti" min="1" max="3" step="0.1" value="1">
                    <span id="boostValue" style="min-width:60px; background:#e2eef7; padding:0.3rem 0.9rem; border-radius:40px; font-weight:600;">1.0x</span>
                </div>
            </div>

            <!-- çº¿æ€§æ¨¡å¼å‚æ•° (é»˜è®¤æ˜¾ç¤º) -->
            <div id="linearParams">
                <div class="param-row">
                    <span class="param-label">ğŸ ç©ºæŠ•ä»·å€¼ (äº¤æ˜“é¢%)</span>
                    <div class="param-input slider-container">
                        <input type="range" id="airdropRate" min="0" max="5" step="0.1" value="1.5">
                        <span id="airdropValue" style="min-width:60px; background:#e2eef7; padding:0.3rem 0.9rem; border-radius:40px; font-weight:600;">1.50%</span>
                    </div>
                </div>
            </div>

            <!-- é˜¶æ¢¯æ¨¡å¼å‚æ•° (é»˜è®¤éšè—) -->
            <div id="ladderParams" style="display: none;">
                <div style="background:#e4f2f5; border-radius:16px; padding:1.2rem; margin-bottom:1rem;">
                    <span style="font-weight:700; color:#0a5468;">ğŸ† Rainbow é˜¶æ¢¯ç§¯åˆ† (å·²é¢„è½½)</span>
                    <div class="ladder-table">
                        <table>
                            <thead><tr><th>äº¤æ˜“é‡ (U)</th><th>ç§¯åˆ†</th><th>ç­‰æ•ˆç©ºæŠ•ç‡*</th></tr></thead>
                            <tbody id="ladderTbody">
                                <!-- JSåŠ¨æ€å¡«å…… -->
                            </tbody>
                        </table>
                        <p style="font-size:0.7rem; margin-top:0.5rem;">*åŸºäºå¥–æ± 350ä¸‡RNBWã€æ€»ç§¯åˆ†38,000ã€RNBW=$0.1ä¼°ç®—ï¼Œå®é™…å¯è°ƒ</p>
                    </div>
                </div>
                <div class="param-row">
                    <span class="param-label">ğŸ« å¥–æ± æ€»é¢ (RNBW)</span>
                    <div class="param-input">
                        <input type="number" id="prizePool" value="3500000" step="100000" min="0">
                    </div>
                </div>
                <div class="param-row">
                    <span class="param-label">ğŸ“Š æ€»äº¤æ˜“ç§¯åˆ†</span>
                    <div class="param-input">
                        <input type="number" id="totalPoints" value="37996.64" step="100" min="1">
                    </div>
                </div>
                <div class="param-row">
                    <span class="param-label">ğŸ’° RNBW ä¼°ä»· (U)</span>
                    <div class="param-input">
                        <input type="number" id="rnbwPrice" value="0.1" step="0.01" min="0.01">
                        <span class="unit">U</span>
                    </div>
                </div>
                <p style="font-size:0.8rem; color:#1f677d;">* ä½ çš„äº¤æ˜“é¢å°†æŒ‰è¾¾åˆ°çš„æœ€é«˜æ¡£ä½è·å¾—å›ºå®šç§¯åˆ†ï¼Œéç´¯åŠ ã€‚</p>
            </div>

            <!-- å›ºå®šå‚æ•°æç¤º -->
            <div style="background:#d9eaf3; border-radius:18px; padding:1.2rem; margin-top:1.8rem;">
                <p style="margin:0 0 0.5rem; font-weight:600; color:#05435e;">ğŸ“Œ å›ºå®šåè®®å‚æ•°</p>
                <div style="display:flex; flex-wrap:wrap; gap:0.8rem; font-size:0.9rem;">
                    <span>ğŸ“… Uè´¨æŠ¼æ—¥å¥–åŠ±: <strong>0.5%</strong> (Uæœ¬ä½)</span>
                    <span>ğŸ’¸ äº¤æ˜“ç¨: <strong>5%</strong> åŒå‘</span>
                    <span>â†©ï¸ OKXè¿”ä½£: <strong>0.34%</strong> äº¤æ˜“é¢</span>
                    <span>ğŸ”„ å›è´­åˆ†é…: 80%è¿”æ±  / 20%é”€æ¯</span>
                </div>
            </div>
        </div>

        <!-- ========= å³ä¾§è¾“å‡ºåŒº ========= -->
        <div class="output-section">
            <h3 style="margin-top:0; margin-bottom:1.8rem; font-weight:600; color: #135664;">ğŸ“Š ä½ çš„æ¯æ—¥æŸç›Š</h3>
            <!-- æ¯æ—¥Hå¥–åŠ± -->
            <div style="display:flex; justify-content:space-between; align-items:baseline;">
                <span class="stat-label">ğŸ’° æ¯æ—¥Hå¥–åŠ± (Uç­‰å€¼)</span>
                <span style="font-size:1.8rem; font-weight:700; color:#0e5a4a;" id="dailyRewardU">50.00</span>
                <span class="unit">U</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-top:0.2rem;">
                <span class="stat-label">â”• å¯¹åº”Hæ•°é‡</span>
                <span style="font-weight:600;" id="dailyHAmount">50,000</span>
                <span class="unit">H</span>
            </div>
            <!-- äº¤æ˜“ç£¨æŸ -->
            <div style="display:flex; justify-content:space-between; margin-top:0.5rem;">
                <span class="stat-label">ğŸ“‰ äº¤æ˜“ç£¨æŸ (5%ç¨)</span>
                <span style="font-weight:600;" id="taxAmount">2.50</span>
                <span class="unit">Uç­‰å€¼</span>
            </div>
            <!-- ç©ºæŠ•æ”¶ç›Š (åŠ¨æ€) -->
            <div style="display:flex; justify-content:space-between; margin-top:0.2rem;">
                <span class="stat-label" id="airdropLabel">ğŸ ç©ºæŠ•æ”¶ç›Š (çº¿æ€§)</span>
                <span style="font-weight:600;" id="airdropAmount">0.75</span>
                <span class="unit">U</span>
            </div>
            <!-- å‡€æ”¶ç›Šå¡ç‰‡ -->
            <div style="background:#dff0f9; border-radius:24px; padding:1.2rem 1.5rem; margin:1.2rem 0;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:600; font-size:1.1rem;">âœ… å‡€æ—¥æ”¶ç›Š (U)</span>
                    <span style="font-size:2.2rem; font-weight:800; color:#0b543a;" id="netProfitU">48.25</span>
                    <span class="unit">U</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:0.2rem;">
                    <span>å¹´åŒ–æ”¶ç›Šç‡ (åŸºäºè´¨æŠ¼U)</span>
                    <span style="font-weight:700; background:#c1e5d8; padding:0.2rem 1rem; border-radius:50px;" id="aprValue">176.1%</span>
                </div>
            </div>

            <!-- é˜¶æ¢¯æ¨¡å¼æœ€ä¼˜æ¡£ä½æç¤º (ä»…é˜¶æ¢¯æ˜¾ç¤º) -->
            <div id="ladderOptDiv" style="display: none; background:#ffefc0; border-radius:16px; padding:0.8rem 1.2rem; margin-bottom:1rem;">
                <span style="font-weight:700;">ğŸ¯ æ¨èåˆ·é‡æ¡£ä½: </span><span id="optLadderTip">$8,000 (å¾—5ç§¯åˆ†)</span>
                <span style="margin-left:0.5rem; font-size:0.85rem;">è¾¹é™…ç©ºæŠ•ç‡ <span id="optMarginRate">0.575%</span></span>
            </div>

            <!-- åè®®çº¢çº¿ç›‘æµ‹ (å…¨çƒå‚æ•°) -->
            <div class="protocol-check">
                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.8rem;">
                    <span style="background:#2c8392; width:10px; height:10px; border-radius:10px;"></span>
                    <span style="font-weight:600; color:#063b4a;">âš–ï¸ åè®®æ”¶æ”¯çº¢çº¿ (9.36%)</span>
                </div>
                <div style="display:flex; flex-wrap:wrap; justify-content:space-between;">
                    <span>å…¨ç½‘TVL_U</span>
                    <span style="font-weight:700;"><span id="tvlDisplay">1,000,000</span> U</span>
                </div>
                <div style="display:flex; flex-wrap:wrap; justify-content:space-between; margin-top:0.3rem;">
                    <span>æ‰€éœ€æœ€å°æ—¥äº¤æ˜“é¢</span>
                    <span style="font-weight:700;"><span id="requiredTxVolume">93,600</span> U</span>
                </div>
                <div style="display:flex; flex-wrap:wrap; justify-content:space-between; margin-top:0.3rem;">
                    <span>ä½ çš„ä¸ªäººæ—¥äº¤æ˜“é¢</span>
                    <span style="font-weight:700;" id="userTxVolume">50.00</span> <span class="unit">U</span>
                </div>
                <div style="margin-top:0.8rem; padding:0.6rem 1rem; background:rgba(255,255,255,0.7); border-radius:20px;" id="protocolStatus">
                    âš ï¸ ä¸ªäººäº¤æ˜“é¢ä¸å½±å“çº¢çº¿ï¼Œéœ€å…¨ç½‘åˆåŠ›
                </div>
            </div>
        </div>
    </div>

    <!-- å…¨ç½‘å‚æ•°è°ƒèŠ‚æ  -->
    <div style="margin-top:1.8rem; background:#ecf3fa; border-radius:26px; padding:1.2rem 1.8rem; display:flex; flex-wrap:wrap; align-items:center; gap:2rem;">
        <div style="display:flex; align-items:center; gap:1rem;">
            <span style="font-weight:600; color:#0a4055;">ğŸŒ å…¨ç½‘TVL_U (Uè´¨æŠ¼æ€»é‡)</span>
            <input type="number" id="globalTvl" value="1000000" step="100000" min="100000" style="width:150px; padding:0.5rem 1rem; border-radius:20px; border:1px solid #acc3d6;">
            <span class="unit">U</span>
        </div>
        <div style="display:flex; align-items:center; gap:1rem;">
            <span style="font-weight:600; color:#0a4055;">ğŸŒ å…¨ç½‘Hæ—¥äº¤æ˜“é¢</span>
            <input type="number" id="globalTx" value="100000" step="10000" min="0" style="width:150px; padding:0.5rem 1rem; border-radius:20px; border:1px solid #acc3d6;">
            <span class="unit">U</span>
        </div>
        <button id="updateGlobalBtn">æ›´æ–°çº¢çº¿çŠ¶æ€</button>
    </div>

    <div class="divider"></div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:1.8rem;">
        <div style="background:#f4fafd; padding:1.5rem; border-radius:24px;">
            <span style="font-size:1.4rem; margin-right:0.3rem;">ğŸ§®</span>
            <span style="font-weight:700; font-size:1.1rem;">ç”¨æˆ·æŸç›Šæ ¸å¿ƒå…¬å¼</span>
            <ul style="margin-top:0.8rem; list-style:none; padding-left:0;">
                <li style="margin-bottom:0.4rem;">â€¢ æ¯æ—¥Hå¥–åŠ±(U) = è´¨æŠ¼U Ã— 0.5% Ã— veHåŠ æˆ</li>
                <li style="margin-bottom:0.4rem;">â€¢ äº¤æ˜“é¢ = æ¯æ—¥Hå¥–åŠ±(U)ï¼ˆå…¨éƒ¨å–å‡ºï¼‰</li>
                <li style="margin-bottom:0.4rem;">â€¢ äº¤æ˜“ç¨ = äº¤æ˜“é¢ Ã— 5%</li>
                <li style="margin-bottom:0.4rem;">â€¢ ç©ºæŠ•æ”¶ç›Š = çº¿æ€§æ¨¡å¼: äº¤æ˜“é¢Ã—æ¯”ä¾‹ï¼›é˜¶æ¢¯æ¨¡å¼: ç§¯åˆ†ä»·å€¼</li>
                <li style="margin-bottom:0.4rem;"><strong>å‡€æ”¶ç›Š = Hå¥–åŠ± - äº¤æ˜“ç¨ + ç©ºæŠ•</strong></li>
            </ul>
        </div>
        <div style="background:#e6f0f5; padding:1.5rem; border-radius:24px;" id="strategyTip">
            <span style="font-size:1.4rem; margin-right:0.3rem;">ğŸ’¡</span>
            <span style="font-weight:700; font-size:1.1rem;">å½“å‰ç­–ç•¥å»ºè®®</span>
            <p style="margin-top:0.8rem;" id="strategyText">çº¿æ€§æ¨¡å¼ä¸‹ï¼Œç©ºæŠ•ä»·å€¼è¶Šé«˜è¶Šèµšï¼›é˜¶æ¢¯æ¨¡å¼ä¸‹è¯·é€‰æ‹©æœ€ä¼˜æ¡£ä½ã€‚</p>
        </div>
    </div>
    <div class="footnote">
        âš¡ é˜¶æ¢¯ç§¯åˆ†åŸºäº Rainbow æ´»åŠ¨å‚æ•°ï¼šå¥–æ± 350ä¸‡RNBWï¼Œæ€»ç§¯åˆ†38,000ï¼ŒRNBW=$0.1ã€‚å¯æ‰‹åŠ¨è°ƒæ•´ã€‚æ‰€æœ‰ç»“æœå®æ—¶è®¡ç®—ã€‚
    </div>
</div>

<script>
    (function() {
        'use strict';

        // ----- å…ƒç´ ç»‘å®š -----
        const stakeU = document.getElementById('stakeU');
        const hPrice = document.getElementById('hPrice');
        const boostMulti = document.getElementById('boostMulti');
        const boostValue = document.getElementById('boostValue');
        // çº¿æ€§
        const airdropRate = document.getElementById('airdropRate');
        const airdropValue = document.getElementById('airdropValue');
        // é˜¶æ¢¯
        const prizePool = document.getElementById('prizePool');
        const totalPoints = document.getElementById('totalPoints');
        const rnbwPrice = document.getElementById('rnbwPrice');
        // å…¨å±€
        const globalTvl = document.getElementById('globalTvl');
        const globalTx = document.getElementById('globalTx');

        // è¾“å‡º
        const dailyRewardU = document.getElementById('dailyRewardU');
        const dailyHAmount = document.getElementById('dailyHAmount');
        const taxAmount = document.getElementById('taxAmount');
        const airdropAmount = document.getElementById('airdropAmount');
        const airdropLabel = document.getElementById('airdropLabel');
        const netProfitU = document.getElementById('netProfitU');
        const aprValue = document.getElementById('aprValue');
        const userTxVolume = document.getElementById('userTxVolume');
        const tvlDisplay = document.getElementById('tvlDisplay');
        const requiredTxVolume = document.getElementById('requiredTxVolume');
        const protocolStatus = document.getElementById('protocolStatus');
        const ladderOptDiv = document.getElementById('ladderOptDiv');
        const optLadderTip = document.getElementById('optLadderTip');
        const optMarginRate = document.getElementById('optMarginRate');
        const strategyText = document.getElementById('strategyText');

        // æ¨¡å¼åˆ‡æ¢
        const modeLinearBtn = document.getElementById('modeLinear');
        const modeLadderBtn = document.getElementById('modeLadder');
        const linearParams = document.getElementById('linearParams');
        const ladderParams = document.getElementById('ladderParams');

        // é˜¶æ¢¯è¡¨æ ¼å¡«å……
        const ladderTbody = document.getElementById('ladderTbody');

        // ----- é˜¶æ¢¯æ•°æ® (Rainbow) -----
        const ladderSteps = [
            { volume: 500, points: 1 },
            { volume: 1000, points: 2 },
            { volume: 2000, points: 3 },
            { volume: 4000, points: 4 },
            { volume: 8000, points: 5 },
            { volume: 16000, points: 6 },
            { volume: 32000, points: 7 },
            { volume: 64000, points: 8 }
        ];

        // æ¸²æŸ“é˜¶æ¢¯è¡¨æ ¼
        function renderLadderTable() {
            let html = '';
            const pool = parseFloat(prizePool.value) || 3500000;
            const total = parseFloat(totalPoints.value) || 37996.64;
            const price = parseFloat(rnbwPrice.value) || 0.1;
            const pointValueU = (pool / total) * price; // æ¯ç§¯åˆ†ä»·å€¼ U

            ladderSteps.forEach(step => {
                const equivRate = (step.points * pointValueU / step.volume * 100).toFixed(3);
                html += `<tr><td>$${step.volume.toLocaleString()}</td><td>${step.points}</td><td>${equivRate}%</td></tr>`;
            });
            ladderTbody.innerHTML = html;
        }

        // ----- è®¡ç®—ç§¯åˆ†æ¡£ä½ (è¿”å›ç§¯åˆ†, æ¡£ä½äº¤æ˜“é‡) -----
        function getLadderPoints(txVolumeU) {
            let points = 0;
            let achievedVolume = 0;
            for (let i = ladderSteps.length - 1; i >= 0; i--) {
                if (txVolumeU >= ladderSteps[i].volume) {
                    points = ladderSteps[i].points;
                    achievedVolume = ladderSteps[i].volume;
                    break;
                }
            }
            return { points, achievedVolume };
        }

        // ----- è®¡ç®—æœ€ä¼˜æ¡£ä½ (è¾¹é™…æ”¶ç›Šæœ€é«˜) -----
        function calcOptimalLadder() {
            const pool = parseFloat(prizePool.value) || 3500000;
            const total = parseFloat(totalPoints.value) || 37996.64;
            const price = parseFloat(rnbwPrice.value) || 0.1;
            const pointValueU = (pool / total) * price;

            let bestMargin = 0;
            let bestVolume = 0;
            let bestPoints = 0;
            for (let i = 0; i < ladderSteps.length; i++) {
                const vol = ladderSteps[i].volume;
                const pts = ladderSteps[i].points;
                const airdropU = pts * pointValueU;
                const marginRate = airdropU / vol; // è¾¹é™…ç©ºæŠ•ç‡
                if (marginRate > bestMargin) {
                    bestMargin = marginRate;
                    bestVolume = vol;
                    bestPoints = pts;
                }
            }
            return { volume: bestVolume, points: bestPoints, marginRate: bestMargin * 100 }; // %
        }

        // ----- æ ¸å¿ƒæ›´æ–°å‡½æ•° -----
        function updateAll() {
            // è¯»å–å…¬å…±å‚æ•°
            let stake = parseFloat(stakeU.value) || 10000;
            let price = parseFloat(hPrice.value) || 0.001;
            let boost = parseFloat(boostMulti.value) || 1.0;
            let tvlGlobal = parseFloat(globalTvl.value) || 1000000;
            let txGlobal = parseFloat(globalTx.value) || 100000;

            if (stake < 100) stake = 100;
            if (price < 0.0001) price = 0.0001;
            if (tvlGlobal < 10000) tvlGlobal = 10000;

            boostValue.innerText = boost.toFixed(1) + 'x';

            // --- 1. æ¯æ—¥Hå¥–åŠ± (Uç­‰å€¼) ---
            let rewardU = stake * 0.005 * boost;
            let rewardH = rewardU / price;
            let txVolumeUser = rewardU; // ç”¨æˆ·åˆ·çš„äº¤æ˜“é¢ï¼ˆUï¼‰

            // --- 2. äº¤æ˜“ç£¨æŸ ---
            let taxU = txVolumeUser * 0.05;
            let taxH = taxU / price;

            // --- 3. ç©ºæŠ•æ”¶ç›Š (æ ¹æ®æ¨¡å¼) ---
            let airdropU = 0;
            let isLadderMode = ladderParams.style.display !== 'none';
            if (isLadderMode) {
                // é˜¶æ¢¯æ¨¡å¼
                const pool = parseFloat(prizePool.value) || 3500000;
                const total = parseFloat(totalPoints.value) || 37996.64;
                const rnbwPriceU = parseFloat(rnbwPrice.value) || 0.1;
                const pointValueU = (pool / total) * rnbwPriceU;
                const { points } = getLadderPoints(txVolumeUser);
                airdropU = points * pointValueU;
                airdropLabel.innerText = 'ğŸ ç©ºæŠ•æ”¶ç›Š (é˜¶æ¢¯)';
                // æ˜¾ç¤ºæœ€ä¼˜æ¡£ä½æç¤º
                ladderOptDiv.style.display = 'block';
                const opt = calcOptimalLadder();
                optLadderTip.innerText = `$${opt.volume.toLocaleString()} (å¾—${opt.points}ç§¯åˆ†)`;
                optMarginRate.innerText = opt.marginRate.toFixed(3) + '%';
                // ç­–ç•¥å»ºè®®
                if (txVolumeUser < opt.volume) {
                    strategyText.innerText = `ğŸ“‰ å½“å‰äº¤æ˜“é¢$${txVolumeUser.toFixed(2)}ï¼Œæœªè¾¾åˆ°æœ€ä¼˜æ¡£ä½$${opt.volume}ã€‚è€ƒè™‘é”ä»“veHå¢åŠ é¢åº¦æˆ–ç´¯ç§¯å¤šæ—¥Hå†åˆ·ã€‚`;
                } else {
                    strategyText.innerText = `âœ… å·²è¾¾åˆ°æœ€ä¼˜æ¡£ä½$${opt.volume}ï¼Œè¾¹é™…ç©ºæŠ•ç‡${opt.marginRate.toFixed(3)}%ã€‚ç»§ç»­åˆ·é‡è¾¹é™…æ”¶ç›Šé™ä½ï¼Œå»ºè®®å¤æŠ•é”ä»“ã€‚`;
                }
            } else {
                // çº¿æ€§æ¨¡å¼
                let airdropPercent = parseFloat(airdropRate.value) || 1.5;
                airdropU = txVolumeUser * (airdropPercent / 100);
                airdropLabel.innerText = 'ğŸ ç©ºæŠ•æ”¶ç›Š (çº¿æ€§)';
                ladderOptDiv.style.display = 'none';
                strategyText.innerText = `çº¿æ€§æ¨¡å¼ä¸‹ï¼Œå‡€æ”¶ç›Šä¸ç©ºæŠ•ç‡æ­£ç›¸å…³ã€‚å½“å‰ç©ºæŠ•ç‡ ${airdropPercent}% ç£¨æŸåä»ç›ˆåˆ©ã€‚`;
            }

            // --- 4. å‡€æ”¶ç›Š & å¹´åŒ– ---
            let netU = rewardU - taxU + airdropU;
            let apr = (netU / stake) * 365 * 100;

            // --- 5. åè®®çº¢çº¿ ---
            let requiredTx = tvlGlobal * 0.0936;
            let statusText = '';
            let statusClass = '';
            if (txGlobal >= requiredTx) {
                statusText = 'âœ… å¥åº· Â· äº¤æ˜“é¢è¾¾æ ‡ åè®®å¯æŒç»­';
                statusClass = 'highlight-green';
            } else {
                let percent = (txGlobal / requiredTx * 100).toFixed(1);
                statusText = `âš ï¸ äº¤æ˜“é¢ä¸è¶³ (å½“å‰ ${percent}%) åè®®å¤„äºæ¶ˆè€—å¥–åŠ±æ± çŠ¶æ€`;
                statusClass = 'highlight-red';
            }

            // ----- æ›´æ–°UI -----
            dailyRewardU.innerText = rewardU.toFixed(2);
            dailyHAmount.innerText = Math.round(rewardH).toLocaleString();
            taxAmount.innerText = taxU.toFixed(2);
            airdropAmount.innerText = airdropU.toFixed(2);
            netProfitU.innerText = netU.toFixed(2);
            aprValue.innerText = apr.toFixed(1) + '%';
            userTxVolume.innerText = txVolumeUser.toFixed(2);
            tvlDisplay.innerText = Math.round(tvlGlobal).toLocaleString();
            requiredTxVolume.innerText = Math.round(requiredTx).toLocaleString();
            protocolStatus.innerHTML = `<span class="${statusClass}">${statusText}</span>`;

            // çº¿æ€§æ¨¡å¼ä¸‹æ»‘å—ç™¾åˆ†æ¯”æ˜¾ç¤º
            if (!isLadderMode) {
                let airdropPercent = parseFloat(airdropRate.value) || 1.5;
                airdropValue.innerText = airdropPercent.toFixed(2) + '%';
            }

            // æ›´æ–°é˜¶æ¢¯è¡¨æ ¼ (ä¿è¯ç§¯åˆ†ä»·å€¼å®æ—¶)
            renderLadderTable();
        }

        // ----- æ¨¡å¼åˆ‡æ¢é€»è¾‘ -----
        function setMode(mode) {
            if (mode === 'linear') {
                linearParams.style.display = 'block';
                ladderParams.style.display = 'none';
                modeLinearBtn.classList.add('active');
                modeLadderBtn.classList.remove('active');
                ladderOptDiv.style.display = 'none';
            } else {
                linearParams.style.display = 'none';
                ladderParams.style.display = 'block';
                modeLadderBtn.classList.add('active');
                modeLinearBtn.classList.remove('active');
                // é˜¶æ¢¯optæ˜¾ç¤ºç”±updateæ§åˆ¶
                renderLadderTable();
            }
            updateAll();
        }

        // ----- äº‹ä»¶ç›‘å¬ -----
        modeLinearBtn.addEventListener('click', () => setMode('linear'));
        modeLadderBtn.addEventListener('click', () => setMode('ladder'));

        // è¾“å…¥äº‹ä»¶
        stakeU.addEventListener('input', updateAll);
        hPrice.addEventListener('input', updateAll);
        boostMulti.addEventListener('input', updateAll);
        airdropRate.addEventListener('input', updateAll);
        prizePool.addEventListener('input', updateAll);
        totalPoints.addEventListener('input', updateAll);
        rnbwPrice.addEventListener('input', updateAll);
        globalTvl.addEventListener('input', updateAll);
        globalTx.addEventListener('input', updateAll);
        document.getElementById('updateGlobalBtn').addEventListener('click', updateAll);

        // åˆå§‹åŒ–
        setMode('linear'); // é»˜è®¤çº¿æ€§
        updateAll();
    })();
</script>

</body>
</html>