<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List Application</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>My To-Do List</h1>
        <div id="user-info" style="margin-bottom: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;" role="status" aria-label="用户信息">
            <p><strong>用户ID:</strong> <span id="user-id-display">未提供</span></p>
        </div>
        <div class="form-group">
            <input type="text" id="taskInput" placeholder="Add a new task...">
            <button id="addTaskBtn">Add Task</button>
        </div>
        <div class="filters">
            <select id="categoryFilter">
                <option value="all">All</option>
                <option value="work">Work</option>
                <option value="personal">Personal</option>
            </select>
            <select id="priorityFilter">
                <option value="all">All</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
        </div>
        <ul id="taskList"></ul>
    </div>
    <script src="app.js"></script>
</body>
</html>

<script>
// 从URL参数中提取用户ID
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('id');

// 初始化tasks变量
let tasks;

// 显示用户ID
if (userId) {
    document.getElementById('user-id-display').textContent = userId;
    // 使用用户ID作为localStorage key的一部分，实现个性化数据存储
    const storageKey = `tasks_${userId}`;
    tasks = JSON.parse(localStorage.getItem(storageKey)) || [];
} else {
    tasks = JSON.parse(localStorage.getItem('tasks')) || [];
}

function getStorageKey() {
    return userId ? `tasks_${userId}` : 'tasks';
}

// 安全的优先级颜色映射
function getPriorityColor(priority) {
    const colorMap = {
        'high': 'red',
        'medium': 'orange',
        'low': 'green'
    };
    return colorMap[priority] || 'black';
}

function renderTasks() {
    const taskList = document.getElementById('taskList');
    taskList.innerHTML = '';
    tasks.forEach((task, index) => {
        const li = document.createElement('li');
        
        // 创建安全的元素避免XSS
        const prioritySpan = document.createElement('span');
        prioritySpan.style.color = getPriorityColor(task.priority);
        prioritySpan.textContent = `[${task.priority}]`;
        
        const titleText = document.createTextNode(` ${task.title} `);
        
        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => editTask(index);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = () => deleteTask(index);
        
        li.appendChild(prioritySpan);
        li.appendChild(titleText);
        li.appendChild(editBtn);
        li.appendChild(document.createTextNode(' '));
        li.appendChild(deleteBtn);
        
        taskList.appendChild(li);
    });
}

function addTask() {
    const taskInput = document.getElementById('taskInput');
    const newTask = {
        title: taskInput.value,
        priority: document.querySelector('input[name="priority"]:checked')?.value || 'medium',
    };
    tasks.push(newTask);
    localStorage.setItem(getStorageKey(), JSON.stringify(tasks));
    taskInput.value = '';
    renderTasks();
}

document.getElementById('addTaskBtn').addEventListener('click', addTask);

function editTask(index) {
    const title = prompt('Edit task title:', tasks[index].title);
    if (title) {
        tasks[index].title = title;
        localStorage.setItem(getStorageKey(), JSON.stringify(tasks));
        renderTasks();
    }
}

function deleteTask(index) {
    tasks.splice(index, 1);
    localStorage.setItem(getStorageKey(), JSON.stringify(tasks));
    renderTasks();
}

renderTasks();
</script>\n